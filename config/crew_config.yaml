# CrewAI Agent Configuration
# ===========================
# Using OpenAI GPT-4o-mini + Milvus Cloud

# Supervisor Agent Configuration
supervisor:
  role: "Query Planning Supervisor"
  goal: "Analyze user queries, create execution plans, and coordinate other agents to provide comprehensive answers"
  backstory: |
    You are an expert query analyst and task coordinator. Your job is to understand 
    user queries, determine the best approach to answer them, select appropriate tools 
    and agents, and ensure the final response is accurate and complete.
  verbose: true
  allow_delegation: true
  tools:
    - "query_analyzer"
    - "task_planner"
  max_iterations: 3
  memory: true

# Retriever Agent Configuration
retriever:
  role: "Information Retriever"
  goal: "Retrieve the most relevant information from knowledge bases and web sources"
  backstory: |
    You are a skilled information retrieval specialist. You can search through 
    Milvus Cloud document databases, perform web searches, and combine results 
    using RRF fusion and cross-encoder re-ranking for optimal relevance.
  verbose: true
  allow_delegation: false
  tools:
    - "milvus_search"
    - "milvus_multimodal_search"
    - "web_search"
  max_iterations: 3
  memory: true

# Generator Agent Configuration
generator:
  role: "Answer Generator"
  goal: "Synthesize retrieved information into clear, accurate, and comprehensive answers"
  backstory: |
    You are an expert at analyzing information and generating well-structured, 
    accurate responses. You can synthesize multiple sources, identify key points, 
    and present information in a clear and helpful manner.
  verbose: true
  allow_delegation: false
  tools:
    - "summarizer"
    - "response_formatter"
  max_iterations: 2
  memory: true

# Feedback Agent Configuration
feedback:
  role: "Quality Assurance Specialist"
  goal: "Evaluate, critique, and improve generated responses for accuracy and completeness"
  backstory: |
    You are a critical thinker and quality assurance expert. You review generated 
    responses, identify gaps or inaccuracies, suggest improvements, and ensure 
    the final output meets quality standards.
  verbose: true
  allow_delegation: false
  tools:
    - "reranker"
    - "fact_checker"
    - "response_validator"
  max_iterations: 2
  memory: true

# Crew Configuration
crew:
  name: "RAG Multi-Agent Crew"
  process: "hierarchical" # sequential, hierarchical
  manager_llm: "openai" # OpenAI GPT-4o-mini
  verbose: true
  memory: true
  max_rpm: 10

  # Workflow Configuration
  workflow:
    - agent: "supervisor"
      task: "analyze_query"
      output_to: ["retriever"]

    - agent: "retriever"
      task: "retrieve_information"
      output_to: ["generator"]

    - agent: "generator"
      task: "generate_response"
      output_to: ["feedback"]

    - agent: "feedback"
      task: "validate_response"
      output_to: ["final"]

  # Fallback Strategy
  fallback:
    enabled: true
    max_retries: 2
    strategies:
      - "web_search_fallback"
      - "simplified_query"
      - "direct_llm_response"

# Tool Configurations
tools:
  milvus_search:
    enabled: true
    top_k: 10
    similarity_threshold: 0.3
    index_type: "HNSW"

  milvus_multimodal_search:
    enabled: true
    top_k_per_type: 3
    content_types:
      - "text"
      - "table"
      - "image"

  web_search:
    enabled: true
    max_results: 5

  summarizer:
    enabled: true
    max_length: 500

  reranker:
    enabled: true
    model: "cross-encoder/ms-marco-MiniLM-L-6-v2"
    top_k: 5

# Memory Configuration
memory:
  type: "hybrid" # short_term, long_term, entity, hybrid
  max_items: 100
  ttl: 3600 # seconds
